<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Release Readiness Report</title>
  <!-- Tailwind CSS via CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX transformation in the browser -->
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <!-- Mount point for our React app -->
  <div id="root" class="min-h-screen py-6"></div>

  <script type="text/babel">
    // Sample report data for demonstration. In a real application
    // this data would be fetched from your backend or read from
    // readiness_report.json at runtime.
    const sampleReport = {
      release: {
        service: 'Example Service',
        version: 'v1.0.0',
        generated_at: '2026-02-08T12:34:56Z'
      },
      overall_status: 'YELLOW',
      checks: [
        {
          id: 'check1',
          name: 'Non‑prod Deployment',
          status: 'GREEN',
          summary: 'Deployment to staging completed and healthy.',
          reasons: [],
          evidence: [
            { type: 'argocd_app', identifier: 'example-app', url: '#'}
          ]
        },
        {
          id: 'check2',
          name: 'Regression Tests',
          status: 'RED',
          summary: 'Latest regression test failed.',
          reasons: [
            'Test suite run #105 failed with 23 failures.'
          ],
          evidence: [
            { type: 'jenkins_build', identifier: '105', url: '#' }
          ]
        },
        {
          id: 'check3',
          name: 'Certification (Perf/Chaos/DR)',
          status: 'YELLOW',
          summary: 'Performance certification passed, chaos tests pending.',
          reasons: ['Chaos experiment results not yet available.'],
          evidence: [
            { type: 'jenkins_build', identifier: 'perf-98', url: '#' },
            { type: 'confluence_page', identifier: 'DR summary', url: '#' }
          ]
        },
        {
          id: 'check4',
          name: 'Pre‑Release Review',
          status: 'GREEN',
          summary: 'Helm chart and documentation updated.',
          reasons: [],
          evidence: [
            { type: 'github_pr', identifier: 'pr-42', url: '#' },
            { type: 'confluence_page', identifier: 'Install guide', url: '#' }
          ]
        },
        {
          id: 'check5',
          name: 'Production CM & Testing',
          status: 'YELLOW',
          summary: 'Change request created; testing task incomplete.',
          reasons: ['Testing subtask not yet closed.'],
          evidence: [
            { type: 'cm_ticket', identifier: 'CHG-1234', url: '#' }
          ]
        }
      ]
    };

    // Map statuses to colours
    const STATUS_CLASSES = {
      GREEN: 'bg-green-500 text-white',
      YELLOW: 'bg-yellow-500 text-black',
      RED: 'bg-red-500 text-white'
    };

    function CheckCard({ check }) {
      const { name, status, summary, reasons = [], evidence = [] } = check;
      const statusClass = STATUS_CLASSES[status] || 'bg-gray-300 text-black';
      return (
        <div className="rounded-xl shadow-sm border border-gray-200 p-4 bg-white flex flex-col gap-3">
          <div className="flex items-start justify-between">
            <h3 className="text-lg font-semibold text-gray-800 mr-2 flex-1">{name}</h3>
            <span className={`px-2 py-1 rounded-md text-xs font-semibold ${statusClass}`}>{status}</span>
          </div>
          {summary && <p className="text-sm text-gray-600">{summary}</p>}
          {reasons.length > 0 && (
            <div className="text-sm text-gray-700">
              <div className="font-semibold text-xs text-gray-500 mb-1">Reasons</div>
              <ul className="list-disc list-inside space-y-1 pl-2">
                {reasons.map((reason, idx) => <li key={idx}>{reason}</li>)}
              </ul>
            </div>
          )}
          {evidence.length > 0 && (
            <div className="text-sm text-gray-700">
              <div className="font-semibold text-xs text-gray-500 mb-1">Evidence</div>
              <ul className="list-disc list-inside space-y-1 pl-2">
                {evidence.map((ev, idx) => (
                  <li key={idx}>
                    <a href={ev.url} className="text-blue-600 hover:underline" target="_blank" rel="noopener noreferrer">
                      {ev.type} – {ev.identifier}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
      );
    }

    function ReleaseReadinessUI({ report }) {
      const { release = {}, overall_status: overallStatus = 'UNKNOWN', checks = [] } = report || {};
      const overallStatusClass = STATUS_CLASSES[overallStatus] || 'bg-gray-300 text-black';
      return (
        <div className="max-w-7xl mx-auto p-6 space-y-6">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 bg-white border border-gray-200 rounded-xl shadow-sm p-4">
            <div>
              <h1 className="text-2xl font-bold text-gray-800">Release Readiness Report</h1>
              {release.service && release.version && (
                <p className="text-sm text-gray-600 mt-1">
                  Service: <span className="font-medium">{release.service}</span> • Release: <span className="font-medium">{release.version}</span>
                </p>
              )}
              {release.generated_at && (
                <p className="text-xs text-gray-500 mt-1">Generated {new Date(release.generated_at).toLocaleString()}</p>
              )}
            </div>
            <div className="flex items-center gap-2">
              <span className={`px-4 py-2 rounded-md text-sm font-semibold ${overallStatusClass}`}>{overallStatus}</span>
            </div>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {checks.map((check) => (
              <CheckCard key={check.id} check={check} />
            ))}
          </div>
        </div>
      );
    }

    function App() {
      // In real usage you could fetch real report data here instead of using the sample.
      return <ReleaseReadinessUI report={sampleReport} />;
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
